<div class="bg-white">
  <div class="mx-auto max-w-7xl px-4 py-16 sm:px-6 lg:px-8">
    <div class="mx-auto max-w-2xl lg:max-w-none">
      <div class="text-center">
        <h1 class="text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl">
          <%= @event.name %>
          <% if @event.category == 'utama' %>
            <span class="ml-2 inline-flex items-center rounded-md bg-blue-100 px-2.5 py-0.5 text-sm font-medium text-blue-800">Event Utama</span>
          <% end %>
        </h1>
        <p class="mt-4 text-xl text-gray-500"><%= @event.description %></p>
      </div>

      <% if @event.banner.attached? %>
        <div class="mt-8">
          <%= image_tag @event.banner, class: "w-full h-auto object-cover rounded-lg shadow-md" %>
        </div>
      <% end %>

      <div class="mt-16 space-y-16">
        <div class="bg-gray-50 rounded-lg p-8">
          <h2 class="text-2xl font-bold tracking-tight text-gray-900">Informasi Event</h2>
          <dl class="mt-6 grid grid-cols-1 gap-x-6 gap-y-4 sm:grid-cols-2">
            <div>
              <dt class="text-sm font-medium text-gray-500">Tanggal Event</dt>
              <dd class="mt-1 text-lg text-gray-900"><%= l @event.event_date, format: :long %></dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Lokasi</dt>
              <dd class="mt-1 text-lg text-gray-900"><%= @event.location.presence || "-" %></dd>
            </div>
          </dl>
        </div>

        <% if @event.contact_person1_name.present? || @event.contact_person2_name.present? %>
          <div class="bg-gray-50 rounded-lg p-8">
            <h2 class="text-2xl font-bold tracking-tight text-gray-900">Contact Person</h2>
            <div class="mt-6 grid grid-cols-1 gap-6 sm:grid-cols-2">
              <% if @event.contact_person1_name.present? %>
                <div class="bg-white p-6 rounded-md shadow-sm border-l-4 border-blue-500">
                  <div class="font-semibold text-lg mb-2">
                    <i class="fas fa-user-circle mr-2 text-blue-500"></i>
                    <%= @event.contact_person1_name %>
                  </div>
                  <% if @event.contact_person1_phone.present? %>
                    <div>
                      <a href="tel:<%= @event.contact_person1_phone %>" class="text-blue-600 hover:text-blue-800">
                        <i class="fas fa-phone mr-2"></i>
                        <%= format_phone_number(@event.contact_person1_phone) %>
                      </a>
                    </div>
                  <% end %>
                </div>
              <% end %>
              
              <% if @event.contact_person2_name.present? %>
                <div class="bg-white p-6 rounded-md shadow-sm border-l-4 border-blue-500">
                  <div class="font-semibold text-lg mb-2">
                    <i class="fas fa-user-circle mr-2 text-blue-500"></i>
                    <%= @event.contact_person2_name %>
                  </div>
                  <% if @event.contact_person2_phone.present? %>
                    <div>
                      <a href="tel:<%= @event.contact_person2_phone %>" class="text-blue-600 hover:text-blue-800">
                        <i class="fas fa-phone mr-2"></i>
                        <%= format_phone_number(@event.contact_person2_phone) %>
                      </a>
                    </div>
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>

        <div class="bg-gray-50 rounded-lg p-8">
          <h2 class="text-2xl font-bold tracking-tight text-gray-900">Status Pendaftaran</h2>
          <div class="mt-6">
            <% status_color = case @event.registration_status
                 when 'Pendaftaran dibuka' then 'green'
                 when 'Pendaftaran akan dibuka' then 'yellow'
                 when 'Pendaftaran sudah ditutup' then 'red'
                 when 'Pendaftaran ditutup (Kuota Penuh)' then 'red'
                 else 'gray'
               end %>
            <div class="flex items-center">
              <span class="inline-flex items-center rounded-md bg-<%= status_color %>-100 px-3 py-1 text-base font-medium text-<%= status_color %>-800">
                <%= @event.registration_status %>
              </span>
            </div>

            <% if @event.registration_start.present? && @event.registration_end.present? %>
              <dl class="mt-4 grid grid-cols-1 gap-x-6 gap-y-4 sm:grid-cols-2">
                <div>
                  <dt class="text-sm font-medium text-gray-500">Waktu Pembukaan</dt>
                  <dd class="mt-1 text-lg text-gray-900"><%= l @event.registration_start, format: :long %></dd>
                </div>
                <div>
                  <dt class="text-sm font-medium text-gray-500">Waktu Penutupan</dt>
                  <dd class="mt-1 text-lg text-gray-900"><%= l @event.registration_end, format: :long %></dd>
                </div>
              </dl>
            <% end %>

            <% if @event.max_participants.present? %>
              <div class="mt-6">
                <h3 class="text-lg font-medium text-gray-900">Kuota Peserta</h3>
                <div class="mt-2">
                  <div class="flex items-baseline">
                    <p class="text-2xl font-semibold text-gray-900">
                      <%= @event.participants.count %>
                      <span class="text-sm font-normal text-gray-500">
                        dari <%= @event.max_participants %> kuota
                      </span>
                    </p>
                  </div>
                  <div class="mt-2">
                    <div class="relative h-2 bg-gray-200 rounded-full">
                      <% percentage = (@event.participants.count.to_f / @event.max_participants * 100).round %>
                      <div class="absolute h-2 bg-blue-600 rounded-full" style="width: <%= percentage %>%"></div>
                    </div>
                    <p class="mt-2 text-sm text-gray-500">
                      <% if @event.available_slots > 0 %>
                        Masih tersedia <%= @event.available_slots %> slot pendaftaran
                      <% else %>
                        Kuota pendaftaran sudah penuh
                      <% end %>
                    </p>
                  </div>
                </div>
              </div>
            <% end %>

            <div class="mt-6">
              <% if @event.registration_open? %>
                <%= link_to "Daftar Sekarang", new_event_participant_path(@event), class: "inline-flex items-center justify-center rounded-md border border-transparent bg-blue-600 px-6 py-3 text-base font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" %>
              <% else %>
                <%= link_to "Cek Status Pendaftaran", check_registration_event_path(@event), class: "inline-flex items-center justify-center rounded-md border border-gray-300 bg-white px-6 py-3 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" %>
              <% end %>
            </div>
          </div>
        </div>

        <div class="bg-gray-50 rounded-lg p-8">
          <h2 class="text-2xl font-bold tracking-tight text-gray-900">Statistik Event</h2>
          <div class="mt-6 grid grid-cols-1 gap-6 sm:grid-cols-3">
            <div class="bg-white p-6 rounded-md shadow-sm text-center">
              <p class="text-4xl font-bold text-blue-600"><%= @participants_count %></p>
              <p class="mt-2 text-gray-500">Total Peserta</p>
            </div>
            <div class="bg-white p-6 rounded-md shadow-sm text-center">
              <p class="text-4xl font-bold text-blue-600"><%= @prizes_count %></p>
              <p class="mt-2 text-gray-500">Total Hadiah</p>
            </div>
            <div class="bg-white p-6 rounded-md shadow-sm text-center">
              <p class="text-4xl font-bold text-blue-600"><%= @awarded_prizes_count %></p>
              <p class="mt-2 text-gray-500">Hadiah Diundi</p>
            </div>
          </div>
        </div>

        <% if @prizes.any? %>
          <div class="bg-gray-50 rounded-lg p-8">
            <h2 class="text-2xl font-bold tracking-tight text-gray-900">Daftar Hadiah</h2>
            <div class="mt-6 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
              <% @prizes.ordered_by_category.each do |prize| %>
                <div class="relative flex flex-col overflow-hidden rounded-lg border <%= prize.category == 'utama' ? 'border-blue-500 border-2 bg-blue-50 shadow-md transform scale-105' : 'border-gray-300 bg-white' %>">
                  <div class="flex flex-1 flex-col p-6">
                    <div class="flex-1">
                      <% if prize.category == 'utama' %>
                        <span class="absolute top-2 right-2 inline-flex items-center rounded-md bg-blue-600 px-2.5 py-1 text-sm font-medium text-white shadow-md">
                          <svg class="mr-1 h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1zm7-10a1 1 0 01.707.293l.707.707.707-.707A1 1 0 0115 2h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-.707-.293L14 5.414l-.707.707A1 1 0 0112 7h-2a1 1 0 01-1-1V4a1 1 0 011-1h2zm2 10a1 1 0 011 1v1h1a1 1 0 110 2h-1v1a1 1 0 11-2 0v-1h-1a1 1 0 110-2h1v-1a1 1 0 011-1z" clip-rule="evenodd"></path>
                          </svg>
                          Hadiah Utama
                        </span>
                      <% end %>
                      <h3 class="mt-2 text-xl font-semibold text-gray-900"><%= prize.name %></h3>
                      <p class="mt-2 text-base text-gray-500"><%= prize.description %></p>
                      <p class="mt-2 text-sm text-gray-500">Jumlah: <%= prize.quantity %> unit</p>
                    </div>
                    <% if prize.winners.any? %>
                      <div class="mt-4 border-t border-gray-200 pt-4">
                        <p class="text-sm font-medium text-gray-500">Pemenang (<%= prize.winners.count %>/<%= prize.quantity %>):</p>
                        <ul class="mt-1 list-disc list-inside text-base text-gray-900">
                          <% prize.winners.each do |winner| %>
                            <li><%= winner.name %></li>
                          <% end %>
                        </ul>
                      </div>
                    <% end %>
                  </div>
                </div>
              <% end %>
            </div>
            <div class="mt-6 text-center">
              <%= link_to "Lihat Semua Hadiah", event_prizes_path(@event), class: "inline-flex items-center justify-center rounded-md border border-transparent bg-blue-600 px-6 py-3 text-base font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" %>
            </div>
          </div>
        <% end %>
        
        <div class="mt-8 text-center">
          <div class="flex flex-wrap justify-center gap-4">
            <%= link_to "← Kembali", events_path, class: "inline-flex items-center justify-center rounded-md border border-gray-300 bg-white px-6 py-3 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" %>
            <% if admin_signed_in? %>
              <div class="relative inline-block text-left">
                <button type="button" class="dropdown-toggle inline-flex items-center justify-center rounded-md border border-transparent bg-blue-600 px-6 py-3 text-base font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                  Kelola Event <i class="fas fa-chevron-down ml-2"></i>
                </button>
                <div class="dropdown-content origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none" hidden>
                  <%= link_to "Kelola Hadiah", admin_panel_event_prizes_path(@event), class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" %>
                  <%= link_to "Kelola Peserta", admin_panel_event_participants_path(@event), class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" %>
                  <%= link_to "Live Drawing", admin_panel_event_live_drawing_path(@event), class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" %>
                  <%= link_to "Edit Event", edit_admin_panel_event_path(@event), class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const dropdownToggles = document.querySelectorAll('.dropdown-toggle');
    
    dropdownToggles.forEach(toggle => {
      toggle.addEventListener('click', function() {
        const dropdownContent = this.nextElementSibling;
        dropdownContent.hidden = !dropdownContent.hidden;
      });
    });
    
    // Close dropdowns when clicking outside
    document.addEventListener('click', function(event) {
      if (!event.target.matches('.dropdown-toggle')) {
        document.querySelectorAll('.dropdown-content').forEach(dropdown => {
          dropdown.hidden = true;
        });
      }
    });
  });
</script>