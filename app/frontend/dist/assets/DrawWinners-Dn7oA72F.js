import{c as d,j as e}from"./ui-CmEgarRF.js";import{f as T,u as U,r as i}from"./vendor-Ce54acmE.js";import{i as u,g as $,f as q,C as W}from"./index-BjMOTf-D.js";import _ from"./SlotMachine-CZt8Z0Tg.js";import"./auth-B5F6nbqB.js";import"./utils-DH2Y5gFI.js";const K=()=>{const{eventId:r}=T(),A=U(),[b,D]=i.useState([]),[c,C]=i.useState([]),[n,g]=i.useState(null),[o,p]=i.useState(!1),[P,E]=i.useState(!0),[w,j]=i.useState(null),[l,N]=i.useState(!1),[R,v]=i.useState(null),[m,f]=i.useState(null),[y,k]=i.useState(null);i.useEffect(()=>{r&&S()},[r]);const S=async()=>{try{j(null);const[s,a]=await Promise.all([u.get(`/api/admin/events/${r}/prizes`),u.get(`/api/admin/events/${r}/winners`)]);D(s.data||[]),C(a.data||[])}catch(s){console.error("Error fetching data:",s),j("Gagal memuat data"),d.error("Gagal memuat data event")}finally{E(!1)}},I=async()=>{if(!n){d.error("Pilih hadiah terlebih dahulu");return}p(!0);try{const s=b.find(t=>t.id===n);if(!s){d.error("Hadiah tidak ditemukan");return}k(s);const a=await u.post(`/api/admin/events/${r}/prize_drawings/${n}/draw`,{},{headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-Token":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}});if(a.data.success){const t=a.data.winner,h={id:t.id,name:t.name,registrationNumber:t.registration_number,institution:t.institution,email:t.email,phoneNumber:t.phone_number};f(h);const M={reel1:a.data.slotAnimation.reel1,reel2:a.data.slotAnimation.reel2,reel3:a.data.slotAnimation.reel3,reel4:a.data.slotAnimation.reel4,reel5:a.data.slotAnimation.reel5,animationDuration:a.data.slotAnimation.animationDuration,reelDelays:a.data.slotAnimation.reelDelays,finalSpinDuration:a.data.slotAnimation.finalSpinDuration};v(M),d.success("Undian berhasil!"),setTimeout(()=>{N(!0)},100),await S(),g(null)}}catch(s){console.error("Error drawing winner:",s);const a=s.response?.data?.error||"Gagal mengundi hadiah";d.error(a)}finally{p(!1)}},H=()=>{N(!1)},x=b.filter(s=>c.filter(t=>t.prizeName===s.name).length<s.quantity);return P?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"animate-pulse mb-8",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"h-8 w-8 bg-white/20 rounded mr-4"}),e.jsx("div",{className:"h-8 bg-white/20 rounded w-48"})]}),e.jsx("div",{className:"h-12 bg-white/20 rounded w-64 mb-4"}),e.jsx("div",{className:"h-6 bg-white/20 rounded w-96"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-2xl p-6",children:[e.jsx("div",{className:"h-6 bg-white/20 rounded w-40 mb-6"}),e.jsx("div",{className:"space-y-4",children:[...Array(4)].map((s,a)=>e.jsx("div",{className:"bg-white/5 rounded-xl p-4 border border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-5 bg-white/20 rounded w-32 mb-2"}),e.jsx("div",{className:"h-4 bg-white/20 rounded w-24"})]}),e.jsx("div",{className:"h-6 bg-white/20 rounded-full w-16"})]})},a))}),e.jsx("div",{className:"mt-6 h-12 bg-white/20 rounded-xl"})]})}),e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-2xl p-6",children:[e.jsx("div",{className:"h-6 bg-white/20 rounded w-36 mb-6"}),e.jsxs("div",{className:"bg-black/30 rounded-xl p-8",children:[e.jsx("div",{className:"grid grid-cols-5 gap-4 mb-8",children:[...Array(5)].map((s,a)=>e.jsx("div",{className:"h-32 bg-white/10 rounded-lg"},a))}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-8 bg-white/20 rounded w-48 mx-auto mb-4"}),e.jsx("div",{className:"h-6 bg-white/20 rounded w-32 mx-auto"})]})]})]})})]}),e.jsx("div",{className:"mt-8 animate-pulse",children:e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-2xl p-6",children:[e.jsx("div",{className:"h-6 bg-white/20 rounded w-36 mb-6"}),e.jsx("div",{className:"space-y-3",children:[...Array(3)].map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-full"}),e.jsxs("div",{children:[e.jsx("div",{className:"h-4 bg-white/20 rounded w-32 mb-2"}),e.jsx("div",{className:"h-3 bg-white/20 rounded w-24"})]})]}),e.jsx("div",{className:"h-6 bg-white/20 rounded w-20"})]},a))})]})})]})}):w?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-red-100",children:e.jsx($,{className:"h-6 w-6 text-red-600"})}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-white",children:"Error"}),e.jsx("p",{className:"mt-2 text-gray-300",children:w})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900",children:[e.jsx("div",{className:"bg-black/20 backdrop-blur-sm border-b border-white/10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("button",{onClick:()=>A("/admin/dashboard"),className:"flex items-center space-x-2 text-white hover:text-yellow-300 transition-colors",children:[e.jsx(q,{className:"h-5 w-5"}),e.jsx("span",{children:"Kembali ke Dashboard"})]})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"🎰 UNDIAN BERHADIAH 🎰"}),e.jsxs("p",{className:"text-yellow-300 text-sm",children:["Event ID: ",r]})]}),e.jsx("div",{className:"w-32"})," "]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:[e.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"🎁 Pilih Hadiah"}),x.length>0?e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:x.map(s=>{const a=c.filter(h=>h.prizeName===s.name).length,t=s.quantity-a;return e.jsxs("div",{className:`p-4 border rounded-lg cursor-pointer transition-all ${n===s.id?"border-yellow-400 bg-yellow-400/20":"border-white/30 hover:border-yellow-300 hover:bg-white/10"}`,onClick:()=>g(s.id),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-white",children:s.name}),e.jsx(W,{category:s.category==="utama"?"main":"regular",children:s.category==="utama"?"UTAMA":"REGULER"})]}),e.jsx("p",{className:"text-sm text-gray-300 mb-2",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-300",children:["Sisa: ",t,"/",s.quantity]}),n===s.id&&e.jsx("span",{className:"text-yellow-400 font-medium",children:"✓ Dipilih"})]})]},s.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"🎁"}),e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Tidak Ada Hadiah Tersedia"}),e.jsx("p",{className:"text-gray-300",children:"Semua hadiah sudah diundi untuk event ini."})]})]}),n&&x.length>0&&e.jsx("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:e.jsx("button",{onClick:I,disabled:o||l,className:`w-full py-6 px-8 rounded-xl text-2xl font-bold transition-all ${o||l?"bg-gray-600 cursor-not-allowed":"bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-400 hover:to-orange-400 text-white shadow-2xl hover:shadow-yellow-500/50 transform hover:scale-105"}`,children:o||l?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white mr-3"}),"MENGUNDI..."]}):"🎰 MULAI UNDIAN! 🎰"})}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20",children:[e.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"🏆 Daftar Pemenang"}),c.length>0?e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:c.map(s=>e.jsx("div",{className:"bg-white/10 rounded-lg p-3 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:s.participantName}),e.jsx("p",{className:"text-gray-300 text-sm",children:s.prizeName})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-yellow-300 text-xs",children:new Date(s.createdAt).toLocaleDateString("id-ID")})})]})},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-400 text-4xl mb-4",children:"🏆"}),e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Belum Ada Pemenang"}),e.jsx("p",{className:"text-gray-300",children:"Pilih hadiah dan lakukan undian untuk menentukan pemenang."})]}),m&&e.jsx("button",{onClick:()=>{f(null),k(null),v(null)},className:"mt-4 w-full bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors",children:"🗑️ Clear Hasil Terakhir"})]})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx("div",{className:"bg-white/5 backdrop-blur-sm rounded-xl p-8 border border-white/20",children:l||m&&y?e.jsx(_,{isSpinning:l,winner:m,prize:y,slotAnimation:R,onSpinComplete:H,className:"w-full"}):e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"text-8xl mb-6",children:"🎰"}),e.jsx("h2",{className:"text-3xl font-bold text-white mb-4",children:"Slot Machine Siap!"}),e.jsx("p",{className:"text-gray-300 text-lg",children:"Pilih hadiah di panel kiri untuk memulai undian"})]})})})]})})]})};export{K as DrawWinners};
