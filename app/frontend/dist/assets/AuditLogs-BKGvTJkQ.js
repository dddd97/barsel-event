import{j as e,c as U}from"./ui-CmEgarRF.js";import{r as m}from"./vendor-Ce54acmE.js";import{u as $,i as _}from"./index-BjMOTf-D.js";import D from"./AdminLayout-Bdj-l822.js";import"./auth-B5F6nbqB.js";import"./utils-DH2Y5gFI.js";const Q=()=>{const{user:N}=$(),[b,h]=m.useState([]),[n,A]=m.useState({currentPage:1,totalPages:1,totalCount:0,perPage:25}),[g,T]=m.useState({actions:[],resourceTypes:[],admins:[]}),[c,S]=m.useState(null),[P,w]=m.useState(!0),[a,f]=m.useState({adminId:"",actionFilter:"",resourceType:"",startDate:"",endDate:"",page:1}),[y,L]=m.useState(!1);if(!(N?.role==="super_admin"||N?.role==="admin"))return e.jsx(D,{children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:[e.jsx("h3",{className:"text-lg font-medium text-red-800",children:"Akses Ditolak"}),e.jsx("p",{className:"mt-2 text-sm text-red-700",children:"Anda tidak memiliki izin untuk melihat audit logs. Hanya Super Admin dan Admin yang dapat mengakses fitur ini."})]})});const C=async()=>{try{w(!0);const s=new URLSearchParams;Object.entries(a).forEach(([i,o])=>{o&&s.append(i,o.toString())});const r=await _.get("/api/dashboard/stats?limit=100");if(r.data.recentActivities){const i=r.data.recentActivities.map((t,u)=>{const d=(l=>l.actionDisplayName?.includes("Admin")?{type:"admin",type_display:"Administrator",display_name:l.resourceDisplayName||l.adminName||"Admin"}:l.actionDisplayName?.includes("Event")?{type:"event",type_display:"Event",display_name:l.resourceDisplayName||"Event"}:l.actionDisplayName?.includes("Login")||l.actionDisplayName?.includes("Logout")?{type:"auth",type_display:"Authentication",display_name:"System Login"}:{type:"system",type_display:"System",display_name:l.resourceDisplayName||"System Resource"})(t);return{id:t.id||u,admin_name:t.adminName||"Unknown Admin",admin_email:t.adminEmail||t.email||"Email tidak tersedia",action:t.action||"unknown",action_display_name:t.actionDisplayName||t.action||"Unknown Action",resource_type:d.type,resource_type_display_name:d.type_display,resource_display_name:d.display_name,details:t.details||(t.actionDisplayName?.includes("Login")||t.actionDisplayName?.includes("Logout")?"":`Aksi ${t.actionDisplayName||"tidak diketahui"} dilakukan oleh ${t.adminName||"admin"}`),ip_address:t.ipAddress||"IP tidak tersedia",user_agent:t.userAgent||"User agent tidak tersedia",created_at:t.createdAt||new Date().toISOString()}});h(i);const k=i.filter(t=>{if(a.adminId&&t.admin_name!==a.adminId||a.actionFilter&&t.action_display_name!==a.actionFilter||a.resourceType&&t.resource_type_display_name!==a.resourceType)return!1;if(a.startDate||a.endDate){const u=new Date(t.created_at),p=a.startDate?new Date(a.startDate):null,d=a.endDate?new Date(a.endDate):null;if(p&&u<p||d&&u>d)return!1}return!0}),v=25,q=Math.ceil(k.length/v);A({currentPage:a.page,totalPages:q,totalCount:k.length,perPage:v});const M=[...new Set(i.map(t=>t.action_display_name).filter(Boolean))],z=[...new Set(i.map(t=>t.resource_type_display_name).filter(Boolean))],B=[...new Set(i.map(t=>({id:t.id,name:t.admin_name,email:t.admin_email})).filter(t=>t.name))].filter((t,u,p)=>u===p.findIndex(d=>d.name===t.name));T({actions:M,resourceTypes:z,admins:B})}else h([])}catch(s){console.error("Error fetching audit logs:",s);let r="Gagal memuat audit logs";if(s.response)switch(s.response.status){case 403:r="Tidak memiliki akses untuk melihat audit logs";break;case 404:r="Endpoint audit logs tidak ditemukan";break;case 500:r="Terjadi kesalahan pada server";break;default:r=s.response?.data?.message||r}else s.request&&(r="Tidak dapat terhubung ke server");U.error(r),h([])}finally{w(!1)}},I=async()=>{try{const s=await _.get("/api/dashboard/stats");S(s.data)}catch(s){console.error("Error fetching stats:",s);let r="Gagal memuat statistik";s.response?.status===404?r="Statistik audit log tidak tersedia":s.response?.status===403&&(r="Tidak memiliki akses untuk melihat statistik"),console.warn(r)}};m.useEffect(()=>{C(),I()},[a]);const x=(s,r)=>{f(i=>({...i,[s]:r,page:1}))},j=s=>{f(r=>({...r,page:s}))},F=()=>{f({adminId:"",actionFilter:"",resourceType:"",startDate:"",endDate:"",page:1})},E=s=>{if(!s||s==="null"||s==="undefined")return"Tanggal tidak tersedia";try{const r=new Date(s);return isNaN(r.getTime())?"Tanggal tidak valid":r.toLocaleString("id-ID",{timeZone:"Asia/Jakarta",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch(r){return console.error("Error formatting date:",r,"Input:",s),"Tanggal tidak valid"}},R=(s,r)=>{const i=r?.toLowerCase()||s?.toLowerCase()||"";return i.includes("login")?"bg-green-100 text-green-800":i.includes("logout")?"bg-gray-100 text-gray-800":i.includes("update")||i.includes("edit")?"bg-yellow-100 text-yellow-800":i.includes("delete")||i.includes("hapus")?"bg-red-100 text-red-800":i.includes("create")||i.includes("tambah")?"bg-blue-100 text-blue-800":i.includes("draw")||i.includes("prize")?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"};return e.jsx(D,{children:e.jsxs("div",{className:"animate-fade-in-up",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Audit Logs"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Track dan monitor semua aktivitas admin di sistem"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>L(!y),className:"mb-4 inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:[y?"Sembunyikan":"Tampilkan"," Statistik"]}),y&&c&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm font-medium",children:c.totalLogs})})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Logs"}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:c.totalLogs})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm font-medium",children:c.logsToday})})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Hari Ini"}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:c.logsToday})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-purple-500 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm font-medium",children:c.logsThisWeek})})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Minggu Ini"}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:c.logsThisWeek})]})})]})})})]})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Filter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Admin"}),e.jsxs("select",{value:a.adminId,onChange:s=>x("adminId",s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"",children:"Semua Admin"}),g.admins.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Aksi"}),e.jsxs("select",{value:a.actionFilter,onChange:s=>x("actionFilter",s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"",children:"Semua Aksi"}),g.actions.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tipe Resource"}),e.jsxs("select",{value:a.resourceType,onChange:s=>x("resourceType",s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"",children:"Semua Tipe"}),g.resourceTypes.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tanggal Mulai"}),e.jsx("input",{type:"date",value:a.startDate,onChange:s=>x("startDate",s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tanggal Akhir"}),e.jsx("input",{type:"date",value:a.endDate,onChange:s=>x("endDate",s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:F,className:"w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Clear Filters"})})]})]}),e.jsxs("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:[e.jsx("ul",{className:"divide-y divide-gray-200",children:P?[...Array(8)].map((s,r)=>e.jsx("li",{className:"px-6 py-4 animate-pulse",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-24"})]}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-16"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-20"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-24"})]})]})]})},r)):b.length===0?e.jsx("li",{className:"px-6 py-4 text-center",children:e.jsx("p",{className:"text-sm text-gray-500",children:"Tidak ada audit logs ditemukan"})}):b.filter(s=>{if(!s||!s.id||a.adminId&&s.admin_name!==a.adminId||a.actionFilter&&s.action_display_name!==a.actionFilter||a.resourceType&&s.resource_type_display_name!==a.resourceType)return!1;if(a.startDate||a.endDate){const r=new Date(s.created_at),i=a.startDate?new Date(a.startDate):null,o=a.endDate?new Date(a.endDate):null;if(i&&r<i||o&&r>o)return!1}return!0}).slice((a.page-1)*n.perPage,a.page*n.perPage).map(s=>e.jsx("li",{children:e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${R(s.action||"",s.action_display_name)}`,children:s.action_display_name||s.action||"Aksi Tidak Diketahui"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.admin_name||"Admin Tidak Diketahui"}),s.admin_email&&s.admin_email!=="Email tidak tersedia"&&e.jsx("p",{className:"text-sm text-gray-500",children:s.admin_email})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-900",children:E(s.created_at)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.ip_address||"IP tidak tersedia"})]})]}),s.resource_display_name&&s.resource_display_name!=="System Login"&&s.resource_type!=="auth"&&e.jsx("div",{className:"mt-2",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsxs("span",{className:"font-medium",children:[s.resource_type_display_name,":"]})," ",s.resource_display_name]})}),s.details&&e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-gray-600",children:s.details})})]})},s.id))}),n.totalPages>1&&e.jsxs("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>j(n.currentPage-1),disabled:n.currentPage===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Previous"}),e.jsx("button",{onClick:()=>j(n.currentPage+1),disabled:n.currentPage===n.totalPages,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Next"})]}),e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing"," ",e.jsx("span",{className:"font-medium",children:(n.currentPage-1)*n.perPage+1})," ","to"," ",e.jsx("span",{className:"font-medium",children:Math.min(n.currentPage*n.perPage,n.totalCount)})," ","of"," ",e.jsx("span",{className:"font-medium",children:n.totalCount})," results"]})}),e.jsx("div",{children:e.jsx("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[...Array(n.totalPages)].map((s,r)=>{const i=r+1;return e.jsx("button",{onClick:()=>j(i),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${i===n.currentPage?"z-10 bg-primary-50 border-primary-500 text-primary-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:i},i)})})})]})]})]})]})})};export{Q as default};
