import{c as o,j as e}from"./ui-CmEgarRF.js";import{f as Y,r as i}from"./vendor-Ce54acmE.js";import z from"./AdminLayout-Bdj-l822.js";import{i as p}from"./index-BjMOTf-D.js";import"./auth-B5F6nbqB.js";import"./utils-DH2Y5gFI.js";const le=()=>{const{eventId:$}=Y(),[N,H]=i.useState([]),[w,I]=i.useState([]),[l,_]=i.useState(null),[R,y]=i.useState(!1),[d,T]=i.useState(null),[B,D]=i.useState(!1),[u,F]=i.useState(null),[m,g]=i.useState(1),[b,k]=i.useState(1),[j,C]=i.useState(0),[f]=i.useState(10),[S,J]=i.useState(""),[v,K]=i.useState("all"),[q,M]=i.useState(!1),[c,h]=i.useState({name:"",description:"",quantity:1,category:"reguler",event_id:""}),U=i.useCallback(async()=>{try{const a=await p.get("/api/admin/events");I(a.data),!$&&a.data.length>0&&_(a.data[0].id)}catch(a){console.error("Error fetching events:",a),o.error("Gagal memuat daftar event")}},[$]);i.useEffect(()=>{U()},[U]),i.useEffect(()=>{l&&P(l)},[l,m,S,v]);const P=async a=>{D(!0);try{const t=await p.get(`/api/admin/events/${a}/prizes`,{params:{page:m,per_page:f,search:S,category:v!=="all"?v:void 0}}),r=t.data.prizes||t.data;if(H(Array.isArray(r)?r:[]),t.data.pagination){const s=t.data.pagination.total_pages||t.data.pagination.totalPages||1,n=t.data.pagination.current_page||t.data.pagination.currentPage||1,x=t.data.pagination.total_count||t.data.pagination.totalCount||0;console.log("Setting pagination:",{totalPages:s,currentPage:n,totalCount:x}),k(s),g(n),C(x)}else{const s=Array.isArray(r)?r.length:0;s>=f?(k(Math.max(2,Math.ceil(s/f)+1)),C(s)):(k(1),C(s)),g(m)}}catch(t){console.error("Error fetching prizes:",t),o.error("Gagal memuat data hadiah"),H([])}finally{D(!1)}},L=async a=>{if(a.preventDefault(),!l&&!c.event_id){o.error("Pilih event terlebih dahulu");return}if(u){if(u.size>2*1024*1024){o.error("Ukuran file gambar maksimal 2MB");return}if(!u.type.startsWith("image/")){o.error("File harus berupa gambar (PNG, JPG, JPEG, WebP)");return}}const t=c.event_id||String(l);try{const r=new FormData;Object.entries(c).forEach(([s,n])=>{n!=null&&r.append(`prize[${s}]`,String(n))}),r.append("prize[event_id]",t),u&&r.append("prize[image]",u),d?(await p.put(`/api/admin/events/${t}/prizes/${d.id}`,r,{headers:{"Content-Type":"multipart/form-data"}}),o.success("Hadiah berhasil diperbarui")):(await p.post(`/api/admin/events/${t}/prizes`,r,{headers:{"Content-Type":"multipart/form-data"}}),o.success("Hadiah berhasil ditambahkan")),y(!1),P(Number(t)),G()}catch(r){console.error("Error saving prize:",r),o.error("Gagal menyimpan hadiah")}},O=a=>{T(a),h({name:a.name,description:a.description||"",quantity:a.quantity,category:a.category||"reguler",event_id:String(a.eventId)}),y(!0)},W=async(a,t)=>{if(window.confirm("Apakah Anda yakin ingin menghapus hadiah ini?"))try{await p.delete(`/api/admin/events/${t}/prizes/${a}`),o.success("Hadiah berhasil dihapus"),P(t)}catch(r){console.error("Error deleting prize:",r),o.error("Gagal menghapus hadiah")}},V=async()=>{if(!l)return"";try{const a=await p.get(`/api/admin/events/${l}/prizes`,{params:{page:1,per_page:1e4,search:"",category:void 0}}),t=a.data.prizes||a.data||[];console.log(`✅ Successfully fetched ${t.length} prizes for export`);const s=[["Nama Hadiah","Deskripsi","Kategori","Jumlah Total","Telah Diundi","Sisa"].join(",")];return t.forEach(n=>{const x=n.quantity-(n.winningsCount||0),E=[`"${n.name||""}"`,`"${n.description||""}"`,`"${n.category||""}"`,`"${n.quantity||0}"`,`"${n.winningsCount||0}"`,`"${x}"`];s.push(E.join(","))}),s.join(`
`)}catch(a){console.error("Error fetching all prizes for export:",a);const r=[["Nama Hadiah","Deskripsi","Kategori","Jumlah Total","Telah Diundi","Sisa"].join(",")];return N.forEach(s=>{const n=s.quantity-(s.winningsCount||0),x=[`"${s.name||""}"`,`"${s.description||""}"`,`"${s.category||""}"`,`"${s.quantity||0}"`,`"${s.winningsCount||0}"`,`"${n}"`];r.push(x.join(","))}),r.join(`
`)}},Z=async()=>{if(l){M(!0);try{console.log("Starting prizes export process...");const a=await V();if(!a||a.trim()===""){o.error("Tidak ada data hadiah untuk diekspor");return}const t=new Blob([a],{type:"text/csv;charset=utf-8;"});if(t.size===0){o.error("File CSV kosong - tidak ada data untuk diekspor");return}const r=window.URL.createObjectURL(t),s=document.createElement("a");s.href=r;const n=w.find(X=>X.id===l),E=`hadiah-${n?n.name.replace(/[^a-zA-Z0-9]/g,"-"):l}-${new Date().toISOString().split("T")[0]}.csv`;s.setAttribute("download",E),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(r);const Q=a.split(`
`).length-1;o.success(`✅ Data ${Q} hadiah berhasil diunduh`)}catch(a){console.error("Error during export:",a),o.error("Gagal mengunduh data hadiah - silakan coba lagi")}finally{M(!1)}}},A=()=>{l&&g(1)},G=()=>{T(null),F(null),h({name:"",description:"",quantity:1,category:"reguler",event_id:l?String(l):""})};return e.jsx(z,{children:e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 gap-4",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold",children:"Manajemen Hadiah"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{G(),y(!0)},className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:"Tambah Hadiah"}),e.jsx("button",{onClick:Z,disabled:!l||q,className:"bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 disabled:bg-gray-400 flex items-center gap-2",children:q?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Mengunduh..."})]}):"Export CSV"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Pilih Event"}),e.jsxs("select",{value:l||"",onChange:a=>_(Number(a.target.value)),className:"w-full md:w-1/3 border border-gray-300 p-2 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Pilih Event"}),w.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),l&&e.jsx("div",{className:"mb-6 bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Cari Hadiah"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:S,onChange:a=>J(a.target.value),placeholder:"Cari berdasarkan nama atau deskripsi hadiah",className:"w-full border border-gray-300 p-2 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",onKeyDown:a=>a.key==="Enter"&&A()}),e.jsx("button",{onClick:A,className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:"Cari"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Filter Kategori"}),e.jsxs("select",{value:v,onChange:a=>K(a.target.value),className:"w-full border border-gray-300 p-2 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"Semua Kategori"}),e.jsx("option",{value:"utama",children:"Hadiah Utama"}),e.jsx("option",{value:"reguler",children:"Hadiah Reguler"})]})]})]})}),B?e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsx("div",{className:"overflow-x-auto bg-white rounded-lg shadow",children:l?N.length>0?e.jsxs(e.Fragment,{children:[j>0&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsxs("strong",{children:["Total: ",j," hadiah"]})," | Menampilkan ",(m-1)*f+1," - ",Math.min(m*f,j)," dari ",j," hadiah | Halaman ",m," dari ",b]})}),e.jsxs("table",{className:"min-w-full border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"px-2 sm:px-4 py-2 border text-xs sm:text-sm",children:"Gambar"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 border text-xs sm:text-sm",children:"Nama Hadiah"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 border text-xs sm:text-sm hidden md:table-cell",children:"Deskripsi"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 border text-xs sm:text-sm",children:"Kategori"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 border text-xs sm:text-sm",children:"Jumlah"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 border text-xs sm:text-sm",children:"Telah Diundi"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 border text-xs sm:text-sm",children:"Aksi"})]})}),e.jsx("tbody",{children:N.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-2 sm:px-4 py-2 border text-xs sm:text-sm",children:[a.imageUrl||a.gambar_url?e.jsx("img",{src:(a.imageUrl||a.gambar_url)?.startsWith("http")?a.imageUrl||a.gambar_url:`http://localhost:3000${a.imageUrl||a.gambar_url}`,alt:a.name,className:"w-12 h-12 object-cover rounded border",onError:t=>{t.currentTarget.style.display="none",t.currentTarget.nextElementSibling?.removeAttribute("style")}}):null,!(a.imageUrl||a.gambar_url)&&e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded border flex items-center justify-center",children:e.jsx("span",{className:"text-gray-400 text-xs",children:"No Image"})})]}),e.jsx("td",{className:"px-2 sm:px-4 py-2 border text-xs sm:text-sm",children:a.name}),e.jsx("td",{className:"px-2 sm:px-4 py-2 border text-xs sm:text-sm hidden md:table-cell",children:a.description||"-"}),e.jsx("td",{className:"px-2 sm:px-4 py-2 border text-xs sm:text-sm",children:e.jsx("span",{className:`inline-block px-2 py-1 rounded text-xs ${a.category==="utama"?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:a.category})}),e.jsx("td",{className:"px-2 sm:px-4 py-2 border text-xs sm:text-sm",children:a.quantity}),e.jsxs("td",{className:"px-2 sm:px-4 py-2 border text-xs sm:text-sm",children:[a.winningsCount," / ",a.quantity]}),e.jsx("td",{className:"px-2 sm:px-4 py-2 border text-xs sm:text-sm",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-1 sm:gap-2",children:[e.jsx("button",{onClick:()=>O(a),className:"bg-yellow-500 text-white px-2 py-1 rounded hover:bg-yellow-600 text-xs",children:"Edit"}),e.jsx("button",{onClick:()=>W(a.id,a.eventId),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 text-xs",children:"Hapus"})]})})]},a.id))})]}),b>1&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsxs("div",{className:"flex",children:[e.jsx("button",{onClick:()=>g(a=>Math.max(1,a-1)),disabled:m===1,className:"px-3 py-1 border border-gray-300 rounded-l bg-white disabled:bg-gray-100 disabled:text-gray-400",children:"« Prev"}),Array.from({length:b},(a,t)=>e.jsx("button",{onClick:()=>g(t+1),className:`px-3 py-1 border-t border-b border-gray-300 ${m===t+1?"bg-blue-500 text-white":"bg-white"}`,children:t+1},t+1)),e.jsx("button",{onClick:()=>g(a=>Math.min(b,a+1)),disabled:m===b,className:"px-3 py-1 border border-gray-300 rounded-r bg-white disabled:bg-gray-100 disabled:text-gray-400",children:"Next »"})]})})]}):e.jsx("div",{className:"text-center p-6 bg-gray-100 rounded",children:e.jsx("p",{children:"Belum ada hadiah untuk event ini."})}):e.jsx("div",{className:"text-center p-6 bg-gray-100 rounded",children:e.jsx("p",{children:"Pilih event untuk melihat daftar hadiah."})})}),R&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white p-4 sm:p-6 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold mb-4",children:d?"Edit Hadiah":"Tambah Hadiah Baru"}),e.jsxs("form",{onSubmit:L,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Event *"}),e.jsxs("select",{value:c.event_id||l||"",onChange:a=>h({...c,event_id:a.target.value}),className:"w-full border border-gray-300 p-2 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"Pilih Event"}),w.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Nama Hadiah *"}),e.jsx("input",{type:"text",value:c.name,onChange:a=>h({...c,name:a.target.value}),className:"w-full border border-gray-300 p-2 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Kategori Hadiah *"}),e.jsxs("select",{value:c.category,onChange:a=>h({...c,category:a.target.value}),className:"w-full border border-gray-300 p-2 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"reguler",children:"Hadiah Reguler"}),e.jsx("option",{value:"utama",children:"Hadiah Utama"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Deskripsi"}),e.jsx("textarea",{value:c.description,onChange:a=>h({...c,description:a.target.value}),className:"w-full border border-gray-300 p-2 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,placeholder:"Deskripsi hadiah (opsional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Gambar Hadiah"}),e.jsx("input",{type:"file",accept:"image/*",onChange:a=>F(a.target.files?.[0]||null),className:"w-full border border-gray-300 p-2 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Format: PNG, JPG, JPEG, WebP. Maksimal 2MB. (Opsional)"}),u&&e.jsx("div",{className:"mt-2",children:e.jsxs("p",{className:"text-sm text-green-600",children:["File dipilih: ",u.name," (",(u.size/1024/1024).toFixed(2)," MB)"]})}),d&&(d.imageUrl||d.gambar_url)&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-blue-600",children:"Gambar saat ini:"}),e.jsx("img",{src:(d.imageUrl||d.gambar_url)?.startsWith("http")?d.imageUrl||d.gambar_url:`http://localhost:3000${d.imageUrl||d.gambar_url}`,alt:"Prize current image",className:"max-w-32 max-h-32 object-cover rounded border mt-1",onError:a=>{a.currentTarget.style.display="none"}})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Jumlah Hadiah *"}),e.jsx("input",{type:"number",value:c.quantity,onChange:a=>h({...c,quantity:parseInt(a.target.value)||1}),min:"1",className:"w-full border border-gray-300 p-2 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-2 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>y(!1),className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 w-full sm:w-auto",children:"Batal"}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full sm:w-auto",children:d?"Simpan Perubahan":"Tambah Hadiah"})]})]})]})})]})})};export{le as default};
