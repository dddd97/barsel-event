import{j as e,C as N,U as y,M as $,b as v,P as L,B as w,E as z,d}from"./ui-CmEgarRF.js";import{f as W,u as X,r as l}from"./vendor-Ce54acmE.js";import{a as U,j as H,R as J}from"./auth-B5F6nbqB.js";import{i as R}from"./index-BjMOTf-D.js";import{p as Q,d as V}from"./api-D0ds0U2U.js";import"./utils-DH2Y5gFI.js";const Y=({onEmailSelect:c,onError:x})=>{const r=n=>{try{if(!n.credential){x?.("Tidak ada data kredensial dari Google");return}const o=H(n.credential),u=o.name||`${o.given_name} ${o.family_name}`.trim();c(o.email,u)}catch(o){console.error("Error decoding Google token:",o),x?.("Gagal memproses data dari Google")}},g=()=>{x?.("Gagal menghubungkan dengan Google")};return e.jsx("div",{className:"w-full",children:e.jsx(U,{onSuccess:r,onError:g,useOneTap:!1,theme:"outline",size:"large",text:"continue_with",shape:"rectangular",width:"100%",locale:"id",context:"signin",auto_select:!1,cancel_on_tap_outside:!0})})},ne=()=>{const{id:c}=W(),x=X(),[r,g]=l.useState(null),[n,o]=l.useState({name:"",email:"",phone_number:"",nik:"",institution:""}),[u,k]=l.useState(!1),[E,m]=l.useState(null),[t,p]=l.useState({}),[T,S]=l.useState(!1),[i,C]=l.useState(null),[D,P]=l.useState(!1),[_,G]=l.useState(null),[f,b]=l.useState(null),j=l.useRef(null);l.useEffect(()=>{c&&(async()=>{try{const a=await R.get(`/api/events/${c}`);g(a.data)}catch(a){console.error("Failed to fetch event:",a)}})()},[c]);const h=s=>{o({...n,[s.target.name]:s.target.value}),t[s.target.name]&&p({...t,[s.target.name]:[]})},I=async s=>{if(s.preventDefault(),!n.email){m("Email wajib diisi melalui Google OAuth");return}if(!f){m("Silakan verifikasi bahwa Anda bukan robot");return}k(!0),m(null),p({});try{const a=await R.post(`/api/events/${c}/participants`,{participant:n,"g-recaptcha-response":f});a.status===201&&(C(a.data),S(!0))}catch(a){a&&typeof a=="object"&&"response"in a&&a.response&&typeof a.response=="object"&&"status"in a.response&&a.response.status===422?(m("Terdapat kesalahan pada form. Mohon periksa kembali data yang diisi."),"data"in a.response&&a.response.data&&typeof a.response.data=="object"&&"errors"in a.response.data&&p(a.response.data.errors)):a&&typeof a=="object"&&"response"in a&&a.response&&typeof a.response=="object"&&"data"in a.response&&a.response.data&&typeof a.response.data=="object"&&"error"in a.response.data?m(String(a.response.data.error)):m("Terjadi kesalahan yang tidak terduga. Silakan coba lagi."),j.current&&(j.current.reset(),b(null))}finally{k(!1)}},K=async()=>{if(i){P(!0);try{const s=`/api/events/${c}/participants/${i.id}/download_card`;await V(s)}catch(s){console.error("Failed to download card:",s),alert("Gagal mengunduh kartu peserta")}finally{P(!1)}}},B=(s,a)=>{o(F=>({...F,email:s,name:a||F.name})),G(null)},M=s=>{G(s)},O=s=>{b(s)},q=()=>{b(null)};if(!r)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 py-12",children:e.jsxs("div",{className:"mx-auto max-w-4xl px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"text-center mb-10",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full mx-auto mb-6"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2 mx-auto mb-4"}),e.jsx("div",{className:"h-5 bg-gray-200 rounded w-3/4 mx-auto"})]})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-8 mb-8",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-2/3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-5/6"}),e.jsxs("div",{className:"flex justify-center gap-4 mt-6",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})]})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-6"}),[...Array(5)].map((s,a)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-12 bg-gray-200 rounded-xl"})]},a)),e.jsx("div",{className:"h-12 bg-gray-200 rounded-xl mt-8"})]})})]})});const A=r.maxParticipants&&r.participantsCount>=r.maxParticipants;if(T&&i){const s=async()=>{if(i)try{const a=`/api/events/${c}/participants/${i.id}/download_card`;Q(a)}catch(a){console.error("Failed to preview card:",a),alert("Gagal membuka preview kartu peserta")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-white to-emerald-50 pt-20 pb-12 animate-fade-in-up",children:e.jsxs("div",{className:"mx-auto max-w-4xl px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-10 animate-fade-in-up",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-6",children:e.jsx(N,{className:"w-10 h-10 text-green-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-green-800 mb-4",children:"Registrasi Berhasil!"}),e.jsx("p",{className:"text-lg text-green-600 max-w-2xl mx-auto",children:"Selamat! Data pendaftaran Anda berhasil disimpan."})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 mb-8 animate-fade-in-up-delay-1",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-6 text-center",children:"Data Pendaftaran Anda"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-500 to-emerald-500 text-white p-4 rounded-xl text-center",children:[e.jsx("p",{className:"text-sm font-medium opacity-90",children:"Nomor Registrasi"}),e.jsx("p",{className:"text-2xl font-bold",children:i.registration_number})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(y,{className:"w-5 h-5 text-gray-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Nama Lengkap"}),e.jsx("p",{className:"text-gray-600",children:i.name})]})]}),i.email&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx($,{className:"w-5 h-5 text-gray-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Email"}),e.jsx("p",{className:"text-gray-600",children:i.email})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(v,{className:"w-5 h-5 text-gray-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"NIK"}),e.jsx("p",{className:"text-gray-600 font-mono",children:i.nik})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(L,{className:"w-5 h-5 text-gray-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Nomor Telepon"}),e.jsx("p",{className:"text-gray-600",children:i.phone_number})]})]}),i.institution&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(w,{className:"w-5 h-5 text-gray-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Instansi"}),e.jsx("p",{className:"text-gray-600",children:i.institution})]})]})]})]}),e.jsxs("div",{className:"pt-6 space-y-3",children:[e.jsx("button",{onClick:s,className:"w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white font-semibold py-3 px-6 rounded-xl hover:from-green-700 hover:to-emerald-700 focus:outline-none focus:ring-4 focus:ring-green-200 transition-all duration-200",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"Preview Kartu Peserta"]})}),e.jsx("button",{onClick:K,disabled:D,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold py-3 px-6 rounded-xl hover:from-blue-700 hover:to-indigo-700 focus:outline-none focus:ring-4 focus:ring-blue-200 disabled:opacity-50 transition-all duration-200",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[D?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):e.jsx(v,{className:"w-5 h-5"}),"Download Kartu Peserta"]})})]})]}),e.jsx("div",{className:"text-center space-y-4 animate-fade-in-up-delay-2",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx("button",{onClick:()=>{S(!1),C(null),o({name:"",email:"",phone_number:"",nik:"",institution:""})},className:"inline-flex items-center gap-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold py-3 px-6 rounded-xl hover:from-blue-700 hover:to-indigo-700 focus:outline-none focus:ring-4 focus:ring-blue-200 transition-all duration-200",children:"Daftar Peserta Lain"}),e.jsx("button",{onClick:()=>x("/"),className:"inline-flex items-center gap-2 bg-white text-gray-700 font-semibold py-3 px-6 rounded-xl border-2 border-gray-200 hover:bg-gray-50 hover:border-gray-300 focus:outline-none focus:ring-4 focus:ring-gray-200 transition-all duration-200",children:"Kembali ke Beranda"})]})})]})})}return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 pt-20 pb-12",children:e.jsxs("div",{className:"mx-auto max-w-2xl px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-10",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Daftar Event"}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800 mb-2",children:r.name||r.title}),e.jsx("p",{className:"text-gray-600 mb-4",children:r.description}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-4 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"w-4 h-4"}),new Date(r.eventDate||r.date||"").toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"w-4 h-4"}),r.location]}),r.maxParticipants&&e.jsxs("span",{className:`flex items-center gap-1 ${A?"text-red-500":"text-green-500"}`,children:[e.jsx(y,{className:"w-4 h-4"}),r.participantsCount,"/",r.maxParticipants," peserta"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 relative",children:[u&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-80 backdrop-blur-sm rounded-2xl z-10 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-4 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-blue-600 font-medium",children:"Memproses pendaftaran..."})]})}),A?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(d,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Pendaftaran Ditutup"}),e.jsx("p",{className:"text-gray-600",children:"Event ini telah mencapai kapasitas maksimum peserta."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h3",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Form Pendaftaran"}),e.jsx("p",{className:"text-gray-600",children:"Lengkapi data diri Anda untuk mendaftar event ini"})]}),e.jsxs("form",{onSubmit:I,className:"space-y-6",children:[e.jsxs("div",{className:"group",children:[e.jsxs("label",{htmlFor:"name",className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx(y,{className:"w-4 h-4"}),"Nama Lengkap"]}),e.jsx("input",{type:"text",name:"name",id:"name",required:!0,placeholder:"Masukkan nama lengkap Anda",className:`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-blue-100 ${t.name?.length?"border-red-300 focus:border-red-500":"border-gray-200 focus:border-blue-500 hover:border-gray-300"}`,value:n.name,onChange:h}),t.name?.length>0&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1 animate-slide-down",children:[e.jsx(d,{className:"w-4 h-4"}),t.name[0]]})]}),e.jsxs("div",{className:"group",children:[e.jsxs("label",{htmlFor:"email",className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx($,{className:"w-4 h-4"}),"Alamat Email ",e.jsx("span",{className:"text-blue-600 text-xs",children:"(Wajib dari Google)"})]}),e.jsx("div",{className:"mb-3",children:e.jsx(Y,{onEmailSelect:B,onError:M})}),_&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1",children:[e.jsx(d,{className:"w-4 h-4"}),_]}),e.jsx("input",{type:"email",name:"email",id:"email",placeholder:"Email akan terisi otomatis dari Google",className:`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-blue-100 ${t.email?.length?"border-red-300 focus:border-red-500":"border-gray-200 focus:border-blue-500"} bg-gray-50 cursor-not-allowed`,value:n.email,readOnly:!0,disabled:!0}),t.email?.length>0&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1 animate-slide-down",children:[e.jsx(d,{className:"w-4 h-4"}),t.email[0].includes("sudah terdaftar")?"Email ini sudah terdaftar untuk event ini. Silakan gunakan email lain.":t.email[0]]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Email akan diambil otomatis dari akun Google Anda"})]}),e.jsxs("div",{className:"group",children:[e.jsxs("label",{htmlFor:"phone_number",className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx(L,{className:"w-4 h-4"}),"Nomor Telepon"]}),e.jsx("input",{type:"tel",name:"phone_number",id:"phone_number",required:!0,placeholder:"08123456789",className:`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-blue-100 ${t.phone_number?.length?"border-red-300 focus:border-red-500":"border-gray-200 focus:border-blue-500 hover:border-gray-300"}`,value:n.phone_number,onChange:h}),t.phone_number?.length>0&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1 animate-slide-down",children:[e.jsx(d,{className:"w-4 h-4"}),t.phone_number[0]]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Format: 08xxxxxxxxx atau +62xxxxxxxxx"})]}),e.jsxs("div",{className:"group",children:[e.jsxs("label",{htmlFor:"nik",className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx(v,{className:"w-4 h-4"}),"NIK (Nomor Induk Kependudukan)"]}),e.jsx("input",{type:"text",name:"nik",id:"nik",required:!0,placeholder:"1234567890123456",pattern:"\\d{16}",maxLength:16,className:`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-blue-100 ${t.nik?.length?"border-red-300 focus:border-red-500":"border-gray-200 focus:border-blue-500 hover:border-gray-300"}`,value:n.nik,onChange:h}),t.nik?.length>0&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1 animate-slide-down",children:[e.jsx(d,{className:"w-4 h-4"}),t.nik[0]]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"16 digit angka sesuai KTP"})]}),e.jsxs("div",{className:"group",children:[e.jsxs("label",{htmlFor:"institution",className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx(w,{className:"w-4 h-4"}),"Instansi/Perusahaan ",e.jsx("span",{className:"text-gray-400 text-xs",children:"(Opsional)"})]}),e.jsx("input",{type:"text",name:"institution",id:"institution",placeholder:"",className:`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-blue-100 ${t.institution?.length?"border-red-300 focus:border-red-500":"border-gray-200 focus:border-blue-500 hover:border-gray-300"}`,value:n.institution,onChange:h}),t.institution?.length>0&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center gap-1 animate-slide-down",children:[e.jsx(d,{className:"w-4 h-4"}),t.institution[0]]})]}),E&&e.jsx("div",{className:"bg-red-50 border-2 border-red-200 rounded-xl p-4 animate-slide-down animate-shake",children:e.jsxs("p",{className:"text-red-700 flex items-center gap-2",children:[e.jsx(d,{className:"w-5 h-5"}),E]})}),e.jsx("div",{className:"pt-4",children:e.jsx(J,{ref:j,sitekey:"6LclXpkrAAAAANIBp-1D1TmXXe_Hyj9hJCWzy5Ir",onChange:O,onExpired:q,className:"mx-auto"})}),e.jsx("div",{className:"pt-4",children:e.jsx("button",{type:"submit",disabled:u||!n.email||!f,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold py-4 px-6 rounded-xl hover:from-blue-700 hover:to-indigo-700 focus:outline-none focus:ring-4 focus:ring-blue-200 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-[1.02] active:scale-[0.98]",children:u?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Mendaftar..."]}):n.email?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(N,{className:"w-5 h-5"}),"Daftar Sekarang"]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(d,{className:"w-5 h-5"}),"Pilih Email dari Google Terlebih Dahulu"]})})}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Dengan mendaftar, Anda setuju dengan syarat dan ketentuan yang berlaku."})]})]})]})]})})};export{ne as EventRegistration};
